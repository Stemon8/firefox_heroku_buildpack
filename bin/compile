BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3
VERSION_FIREFOX=82.0.3
ARCHIVE_NAME_FIREFOX=firefox
FILE_NAME_FIREFOX=${ARCHIVE_NAME_FIREFOX}-${VERSION_FIREFOX}.tar.bz2
BUILDPACK_FIREFOX_PACKAGE="https://download.mozilla.org/?product=firefox-${VERSION_FIREFOX}-SSL&os=${PLATFORM}&lang=${LANG}"
LANG=en-US



# Install Firefox
mkdir -p $CACHE_DIR
if ! [ -e $CACHE_DIR/$FILE_NAME_FIREFOX ]; then
  topic "Fetching Firefox package from ${BUILDPACK_FIREFOX_PACKAGE}"
  curl $BUILDPACK_FIREFOX_PACKAGE -L -o $CACHE_DIR/$FILE_NAME_FIREFOX
fi

topic "Extracting Firefox binaries to ${BUILD_DIR}/vendor/${ARCHIVE_NAME_FIREFOX}"
mkdir -p $CACHE_DIR/$ARCHIVE_NAME_FIREFOX
mkdir -p $BUILD_DIR/vendor
tar jxf $CACHE_DIR/$FILE_NAME_FIREFOX -C $CACHE_DIR
mv $CACHE_DIR/$ARCHIVE_NAME_FIREFOX $BUILD_DIR/vendor/